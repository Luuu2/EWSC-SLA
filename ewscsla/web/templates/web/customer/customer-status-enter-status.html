{% extends 'base.html' %}
{% load webtags %}


{% block content %}


    <h1 class="text-2xl pt-10">Customer Status</h1>
    <p class="text-sm">Enter your customer status again each SLA improvement action plan proposed.</p>


    <div class="flex text-sm font-medium text-gray-900 space-x-5 pt-4">
        <p>Selected Department:</p>
        <p>{{ department }}</p>
    </div>


    <form method="post">
        {% csrf_token %}

        <div class="relative overflow-x-auto mt-8">
            <table class="w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400">
                <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
                <tr>
                    <th scope="col" class="px-6 py-3">
                        SLA:
                    </th>
                    <th scope="col" class="px-6 py-3">
                        Improvement Action:
                    </th>
                    <th scope="col" class="px-6 py-3">
                        Internal Customer Status:
                    </th>
                </tr>
                </thead>

                <tbody>

                {% if error %}
                    <tr class="bg-white border-b">
                        <th scope="row" colspan="3"
                            class="px-6 py-4 text-center font-medium text-red-900 whitespace-nowrap">
                            Failed to get SLA Improvement action plans for the given department.
                        </th>
                    </tr>
                {% elif page_obj.object_list %}

                    {{ formset.management_form }}
                    {% for action_plan, form in formset_and_plans %}

                        <tr class="bg-white border-b">
                            <td scope="row"
                                class="px-6 py-4 whitespace-nowrap">
                                <span class="font-medium text-gray-900">SLA {{ forloop.counter }}:</span> {{ action_plan.rating.sla.service_description }}
                            </td>
                            <td class="px-6 py-4">
                                {{ action_plan.improvement_action }}
                            </td>
                            <td class="px-6 py-4">
                                <label for="{{ form.status.id_for_label }}"
                                       class="hidden mb-2 text-sm font-medium text-gray-900">Select Status</label>
                                <select id="{{ form.status.auto_id }}" name="{{ form.status.html_name }}"
                                        class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                                    <option value="0">Resolved</option>
                                    <option value="1">Met All</option>
                                    <option value="2">In Progress</option>
                                    <option value="3" selected>Not Actioned</option>
                                </select>
                            </td>
                        </tr>


                    {% endfor %}


                {% else %}
                    <tr class="bg-white border-b">
                        <th scope="row" colspan="3"
                            class="px-6 py-4 text-center font-medium text-red-900 whitespace-nowrap">
                            No Data Found. No Action Plan Added.
                        </th>
                    </tr>
                {% endif %}


                </tbody>


            </table>
        </div>

        {% if page_obj.object_list %}
            <button type="submit"
                    class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 me-2 my-8 focus:outline-none">
                Save Customer Status
            </button>
        {% endif %}

    </form>




{% endblock %}




