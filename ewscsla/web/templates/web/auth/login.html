{% extends 'base-auth.html' %}
{% load static %}
{% load sso_tags %}
{% load show_form %}


{% block auth %}
    <form action="{% url 'web:login' %}{% if request.POST.next %}?next=
        {{ request.POST.next }}{% elif request.GET.next %}?next={{ request.GET.next }}{% endif %}" method="post" class="h-screen">
        {% csrf_token %}

        <section class="bg-gray-50 object-cover bg-cover bg-center bg-no-repeat h-screen flex"
                 style="background-image: url('{% static "web/images/auth-login-background.jpg" %}');">

            <div class="flex flex-col items-center justify-center px-6 py-8 mx-auto md:h-screen md:py-0 min-w-[450px]">

                <h1 class="mb-8 text-5xl font-black max-w-3xl text-center text-border text-white">Welcome to the EWSC Service Level Agreement Tool</h1>

                <div class="w-full bg-white rounded-lg shadow md:mt-0 sm:max-w-md xl:p-0">
                    <div class="p-6 space-y-4 md:space-y-6 sm:p-8">
                        <h1 class="text-xl font-bold leading-tight tracking-tight text-gray-900 md:text-2xl">
                            Sign in to your account
                        </h1>
                        <form class="space-y-4 md:space-y-6" action="#">
                            <div>
                                <label for="username" class="block mb-2 text-sm font-medium text-gray-900">
                                    Username</label>
                                <input type="text" name="username" id="username"
                                       class="{% if form.username.errors %}input-error{% else %}input-default{% endif %}"
                                       placeholder="name@company.com" required>
                            </div>
                            <div>
                                <label for="password"
                                       class="block mb-2 text-sm font-medium text-gray-900">Password</label>
                                <input type="password" name="password" id="password" placeholder="••••••••"
                                       class="{% if form.password.errors %}input-error{% else %}input-default{% endif %}"
                                       required>
                                {% if form.non_field_errors %}
                                    {% for error in form.non_field_errors %}
                                        <div class="flex items-center p-2 mt-2 text-sm text-red-800 border border-red-300 rounded-lg bg-red-50"
                                             role="alert">
                                            <svg class="flex-shrink-0 inline w-4 h-4 mr-3" aria-hidden="true"
                                                 xmlns="http://www.w3.org/2000/svg" fill="currentColor"
                                                 viewBox="0 0 20 20">
                                                <path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z"></path>
                                            </svg>
                                            <span class="sr-only">Info</span>
                                            <div>
                                                {{ error }}
                                            </div>
                                        </div>
                                    {% endfor %}
                                {% endif %}

                            </div>
                            <button type="submit"
                                    class="w-full text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2">
                                Sign in
                            </button>

                            {# Default Django Admin Block #}
                            {% block content %}
                                {% define_show_form as show_form %}
                                {% if show_form %}
                                    {{ block.super }}
                                {% endif %}
                                {% include 'microsoft_sso/login_sso.html' %}
                            {% endblock %}
                            

                        </form>
                    </div>
                </div>
            </div>
        </section>
    </form>
{% endblock %}


{% block auth1 %}
    <div class="w-full h-full lg:grid lg:grid-cols-2">

        <div class="hidden bg-muted lg:block">

            <img src="{% static 'web/images/ewsc.png' %}"
                 alt="Image"
                 width="1920"
                 height="1080"
                 class="h-screen object-contain dark:brightness-[0.2] dark:grayscale"/>

        </div>

        <div class="flex items-center justify-center py-12 h-screen" style="background: url('{% static "web/images/login-background.jpg" %}') 50% 0 no-repeat;">

            <form action="{% url 'web:login' %}{% if request.POST.next %}?next={{ request.POST.next }}{% elif request.GET.next %}?next={{ request.GET.next }}{% endif %}" method="post">
                {% csrf_token %}
                <div class="flex flex-col items-center justify-center h-full">
                    <div class="w-[300px] bg-white rounded-lg shadow md:w-[400px]">
                        <div class="p-6 space-y-4 md:space-y-6 sm:p-8">
                            <h1 class="text-xl font-bold leading-tight tracking-tight text-gray-900 md:text-2xl">
                                Sign in to your account
                            </h1>
                            <div class="space-y-4 md:space-y-6">
                                <div>
                                    <label for="username" class="block mb-2 text-sm font-medium text-gray-900">
                                        Username</label>
                                    <input type="text" name="username" id="username"
                                           class="{% if form.username.errors %}input-error{% else %}input-default{% endif %}"
                                           placeholder="name@company.com" required>
                                </div>
                                <div>
                                    <label for="password"
                                           class="block mb-2 text-sm font-medium text-gray-900">Password</label>
                                    <input type="password" name="password" id="password" placeholder="••••••••"
                                           class="{% if form.password.errors %}input-error{% else %}input-default{% endif %}"
                                           required>
                                    {% if form.non_field_errors %}
                                        {% for error in form.non_field_errors %}
                                            <div class="flex items-center p-2 mt-2 text-sm text-red-800 border border-red-300 rounded-lg bg-red-50"
                                                 role="alert">
                                                <svg class="flex-shrink-0 inline w-4 h-4 mr-3" aria-hidden="true"
                                                     xmlns="http://www.w3.org/2000/svg" fill="currentColor"
                                                     viewBox="0 0 20 20">
                                                    <path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z"></path>
                                                </svg>
                                                <span class="sr-only">Info</span>
                                                <div>
                                                    {{ error }}
                                                </div>
                                            </div>
                                        {% endfor %}
                                    {% endif %}

                                </div>
                                <button type="submit"
                                        class="w-full text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2">
                                    Sign in
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </form>

        </div>

    </div>
{% endblock %}

{% block js %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(".btn-content").click(function (event) {
        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);
        event.originalEvent.currentTarget.href = event.originalEvent.currentTarget.href + "?next=" + urlParams.get('next');
    });
</script>
{% endblock %}